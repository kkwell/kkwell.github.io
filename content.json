{"meta":{"title":"Kvell","subtitle":null,"description":"test website","author":"Kong","url":"https:kkwell.github.io"},"pages":[{"title":"about","date":"2018-09-28T09:17:52.000Z","updated":"2018-09-28T09:17:52.725Z","comments":true,"path":"about/index.html","permalink":"https:kkwell.github.io/about/index.html","excerpt":"","text":""}],"posts":[{"title":"ThreeDES","slug":"ThreeDES","date":"2018-09-28T05:44:08.000Z","updated":"2018-09-29T01:25:40.414Z","comments":true,"path":"2018/09/28/ThreeDES/","link":"","permalink":"https:kkwell.github.io/2018/09/28/ThreeDES/","excerpt":"","text":"3DES加密算法C++实战1版权声明：本文为原创文章，未经允许不得转载 https://kkwell.github.io/2018/09/28/ThreeDES 首先在尝试使用DES算法之前，一定要先对其算法原理与过程有一个简单的了解熟悉，如果只是应用为主的话，也没必要深究。但是最起码的输入参数、输出参数的类型和作用是要知道的，要不然怎么修改使用呢？继续阅读之前请理解如下概念：DES与3DES的区别、Base64编码和UTF-8编码方式、ECB和CBC模式（因为这里只测试使用这两种方式）、填充方式pkcs5/pkcs7/zero、偏移量 首先是参照对象C#的代码实现，因为使用了1import System.Security.Cryptography 所以实现会异常简单，网上例子一堆，我就不贴连接了，可以自己去找，之后我的分享也会包含C#的测试Demo，Java的过程类似123456import java.security.Key;import javax.crypto.SecretKeyFactory;import javax.crypto.spec.DESedeKeySpec;import javax.crypto.spec.IvParameterSpec;import sun.misc.BASE64Decoder;import sun.misc.BASE64Encoder;网上有很多C语言和C++语言实现的代码，但是很多是有问题的，本文主要参考这篇博客的算法部分: DES算法代码 但是在编译使用后，依然与VS和Java的计算结果不同，主要问题出在以下几个方面 1-填充方式不同参考代码的所有填充方式均为0填充，但是我在查找资料的时候发现pkcs5的BlockSize为8，需要填充几位就把几填充，例如结尾为一个字符那剩下七位都填7，依次类推，而pkcs7的BlockSize为1-255，因此pkcs7的填充部分代码应该也不一样，因此需要将参考代码的填充函数RunPad中的代码做如下替换：源代码： 123if(nType == PAD_PKCS_7)&#123; memset(Out+datalen,0x00,8-res);&#125; 替换后：123if(nType == PAD_PKCS_7)&#123; memset(Out+datalen,8-res,8-res);&#125;因为本人只用到了pkcs7的填充方式，其它的没有添加，如果之后有朋友用到的，可以一起提交升级本github代码。 2-原偏移量需要设定本人偏移量设定如下： 1unsigned char cvec[8] = &#123;1,2,3,4,5,6,7,8&#125;; 3-Qt测试代码实现注意：1加密密匙要转换 2加密数据填充要正确 3解密后填充数据要移除1234567891011121314151617181920212223242526272829303132 QByteArray key = \"YWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4\"; QByteArray data = \"00068900002||20180927095839|||3002800173|0200000777|01|0155129175|||\"; QByteArray base64=key.fromBase64(key);//密匙转换 int keynum = base64.size()/8;//密匙个数 8个一组 unsigned char *pdata = (unsigned char*)data.data(); unsigned char *pkey = (unsigned char*)base64.data(); unsigned char rdata[100000]=&#123;0&#125;; CDES mdes; qDebug()&lt;&lt;\"加密数据:\\n\"&lt;&lt;data&lt;&lt;\"\\n\"; qDebug()&lt;&lt;\"ECB ENCRYPT:\"&lt;&lt;mdes.RunDes(CDES::ENCRYPT,CDES::ECB,pdata,rdata,data.size(),pkey,base64.size()); QByteArray str1((char*)rdata,base64.size()*keynum); qDebug()&lt;&lt;str1.toBase64(); qDebug()&lt;&lt;\"ECB DECRYPT:\"&lt;&lt;mdes.RunDes(CDES::DECRYPT,CDES::ECB,(unsigned char*)str1.data(),rdata,str1.size(),pkey,base64.size()); QByteArray str2((char*)rdata,base64.size()*keynum); for(int i=0;i&lt;8;i++)//解密后填充方式的移除 str2.replace(i+1,\"\"); qDebug()&lt;&lt;QString::fromUtf8(str2);//最后为Utf8格式转换 qDebug()&lt;&lt;\"CBC ENCRYPT:\"&lt;&lt;mdes.RunDes(CDES::ENCRYPT,CDES::CBC,pdata,rdata,data.size(),pkey,base64.size()); QByteArray str3((char*)rdata,base64.size()*keynum); qDebug()&lt;&lt;str3.toBase64(); qDebug()&lt;&lt;\"CBC DECRYPT:\"&lt;&lt;mdes.RunDes(CDES::DECRYPT,CDES::CBC,(unsigned char*)str3.data(),rdata,str3.size(),pkey,base64.size()); QByteArray str4((char*)rdata,base64.size()*keynum); for(int i=0;i&lt;8;i++) str4.replace(i+1,\"\"); qDebug()&lt;&lt;QString::fromUtf8(str4); Qt测试结果 测试环境:Qt5.11.1 Ubuntu16.04 VS测试结果 测试环境:VS2015 Win10 VS C#与Qt C++源代码测试DemoGitHub源代码连接 欢迎一起完善升级","categories":[{"name":"Kong","slug":"Kong","permalink":"https:kkwell.github.io/categories/Kong/"}],"tags":[{"name":"Qt","slug":"Qt","permalink":"https:kkwell.github.io/tags/Qt/"}]},{"title":"森林草原，星辰大海","slug":"森林草原，星辰大海","date":"2018-09-27T15:35:17.000Z","updated":"2018-09-28T08:49:45.256Z","comments":true,"path":"2018/09/27/森林草原，星辰大海/","link":"","permalink":"https:kkwell.github.io/2018/09/27/森林草原，星辰大海/","excerpt":"","text":"缘起听说“只能靠听说 各自爱着不需要证明 当时决定是错的想着联络 不如心底远远问候最美丽莫过于听说你 还回忆其实我也感激当我听说你还相信爱情” ——刘若英 听说新疆最美的不是伊犁，而是喀纳斯。喀纳斯，一个遥远而陌生的名字，一个触及国界的领域。找到的图片看起来美轮美奂，无与伦比，令人心驰。 听说新疆最美的不是伊犁，而是喀纳斯。喀纳斯，一个遥远而陌生的名字，一个触及国界的领域。找到的图片看起来美轮美奂，无与伦比，令人心驰。 且思且行南京–合肥–银川–乌鲁木齐–阿勒泰–喀纳斯–禾木–郑州–南京","categories":[{"name":"C c","slug":"C-c","permalink":"https:kkwell.github.io/categories/C-c/"}],"tags":[{"name":"生活","slug":"生活","permalink":"https:kkwell.github.io/tags/生活/"}]},{"title":"Hello World","slug":"hello-world","date":"2018-09-26T06:20:28.037Z","updated":"2018-09-28T01:05:41.016Z","comments":true,"path":"2018/09/26/hello-world/","link":"","permalink":"https:kkwell.github.io/2018/09/26/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new \"My New Post\" More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}]}